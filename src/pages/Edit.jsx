
import React,{useEffect,useState} from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { doc, getDoc, updateDoc } from 'firebase/firestore';
import { db } from '../firebase';
import { useAuth } from '../auth.jsx';
export default function Edit(){ const { id } = useParams(); const nav = useNavigate(); const { user, userDoc } = useAuth(); const [p,setP]=useState(null); const [title,setTitle]=useState(''); const [price,setPrice]=useState(''); const [address,setAddress]=useState(''); const [img,setImg]=useState(''); const [status,setStatus]=useState('available'); useEffect(()=>{ if(!id) return; (async()=>{ const snap = await getDoc(doc(db,'properties',id)); if(snap.exists()){ const d=snap.data(); setP(d); setTitle(d.title||''); setPrice(d.price||''); setAddress(d.address||''); setImg(d.img||''); setStatus(d.status||'available'); } })(); },[id]); if(!p) return <div className="card">Loading...</div>; if(!user) return <div className="card">Login</div>; if(!(user.uid===p.owner || userDoc?.role==='dealer')) return <div className="card">Not allowed</div>; const save = async(e)=>{ e.preventDefault(); await updateDoc(doc(db,'properties',id),{ title,price,address,img,status }); alert('Saved'); nav('/dashboard'); }; return (<div className="card" style={{maxWidth:760}}><h2>Edit Property</h2><form onSubmit={save}><div className="form-row"><label>Title</label><input value={title} onChange={e=>setTitle(e.target.value)}/></div><div className="form-row"><label>Price</label><input value={price} onChange={e=>setPrice(e.target.value)}/></div><div className="form-row"><label>Address</label><input value={address} onChange={e=>setAddress(e.target.value)}/></div><div className="form-row"><label>Image URL</label><input value={img} onChange={e=>setImg(e.target.value)}/></div><div className="form-row"><label>Status</label><select value={status} onChange={e=>setStatus(e.target.value)}><option value="available">available</option><option value="sold">sold</option></select></div><button>Save</button></form></div>); }
